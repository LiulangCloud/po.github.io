<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        *{
            margin: 0;
            padding: 0;
        }
        body{
            /* background: skyblue ; */
            background-image: url("../images/m-3.jpg");
            background-size: 100%;
        }
        button{
            width: 300px;
            height: 30px;
            display: block;
            margin:  0 auto;
            margin-top: 50px;
            font-size: 20px;
            /* position: absolute;
            top: 600px;
            left: 700px; */
        }
        input{
            /* margin:  0 auto; */
            margin:  0 auto;
            margin-top: 100px;
            display: block;
            width: 200px;
            height: 20px;
            font-size: 20px;
            background: skyblue;
            /* margin-left: 1000px; */
            
        }
        .big{
            position: relative;
            width: 400px;
            height: 400px;
            margin: 0 auto;
            margin-top: 50px;
            /* background-image: url(./æ–°å»ºæ–‡ä»¶å¤¹/one.jpg); */
            /* background: skyblue; */
            /* margin-left: 100px; */
            border: 1px solid orange;
            border-radius: 10px;
            overflow: hidden;
        }
        .big .box{
            position: absolute;
            top: -50px;
            left: 0;
        }
        .big .box .line .check{
            list-style: none;
            width: 98px;
            height: 98px;
            border: 1px solid #999;
            float: left;
        }
        .big .box .line .check.active{
            /* background-image: url("./æ–°å»ºæ–‡ä»¶å¤¹/surprise.png"); */
            background: rgba(23, 33, 33, 0.5);
            
        }
    </style>
</head>
<body>
    <input type="text" value="0" disabled>
    <button>åˆ«è¸©äº†ï¼åˆ«è¸©äº†ï¼åˆ«è¸©è¿™é‡Œ!ğŸ¦¨</button>
    <div class="big">
        <div class="box">
            <!-- <div class="line">
                <li class="check active"></li>
                <li class="check"></li>
                <li class="check"></li>
                <li class="check"></li>
            </div> -->
            <!-- <div class="line">
                <li class="check"></li>
                <li class="check active"></li>
                <li class="check"></li>
                <li class="check"></li>
            </div>
            <div class="line">
                <li class="check"></li>
                <li class="check"></li>
                <li class="check active"></li>
                <li class="check"></li>
            </div>
            <div class="line">
                <li class="check"></li>
                <li class="check"></li>
                <li class="check"></li>
                <li class="check active"></li>
            </div> -->
        </div>
    </div>

    <!-- <script src="$.js"></script> -->
    <script>
        //å®šä¹‰æ¸¸æˆåŒºæ„é€ å‡½æ•°
        function Game(){
            //å®šä¹‰å±æ€§
            //è·å–æ¸¸æˆçš„domå¯¹è±¡
            this.gameDom = document.querySelector(".box");
            //å®šä¹‰ä¸‹è½é€Ÿåº¦
            this.speed = 1;
            //å®šä¹‰æ ‡è¯†ç¬¦
            this.timer = null;
            //å®šä¹‰çŠ¶æ€ç¬¦
            this.isOver = false;
            //å®šä¹‰ä¸€ä¸ªåˆ†æ•°å˜é‡
            this.num = 0;
            //è·å–æ–‡æœ¬æ¡†valueå€¼
            this.numInput = document.querySelector("input")
            //è·å–æŒ‰é’®
            this.btn = document.querySelector("button");
            //è°ƒç”¨åˆå§‹åŒ–æ–¹æ³•
            this.init();
        };

        //æ¸¸æˆä¸‹è½æ–¹æ³•
        Game.prototype.moveDown = function(){
            //ç¼“å­˜this
            // var this = this;
                //å¼€å¯å®šæ—¶å™¨
            this.timer = window.setInterval( function(){
                //è·å–boxçš„topå±æ€§å€¼
                var boxTop = this.gameDom.offsetTop;
                this.gameDom.style.top = boxTop + this.speed +"px";
                if( boxTop >= 0  ){
                    //è®¾ç½®æ­¥é•¿å€¼
                    //åˆ›å»ºè¡Œ
                    this.createLine();
                    //åˆ é™¤è¡Œ
                    this.removeLine();
                    
                }
                //å½“gameDomçš„å­èŠ‚ç‚¹é•¿åº¦å¤§äº4æ—¶æ‰§è¡Œè§¦åº•æ–¹æ³•
                if( this.gameDom.children.length > 4 ){
                   //é»‘å—è§¦åº•æ—¶åœæ­¢å®šæ—¶å™¨
                   this.touchBottom();
               }

            }.bind( this ) ,15)
        }
        //æ¸¸æˆæœ€å‰é¢æ·»åŠ ä¸€è¡Œæ–¹æ³•
        Game.prototype.createLine = function(){
                //åˆ›å»ºè¡Œ
                var newDiv = document.createElement("div");
                newDiv.className = "line"
                //è·å–1åˆ°4çš„éšæœºæ•°
                var random = Math.floor( Math.random()*(4-1+1)+1 );
                //å¾ªç¯éå†ç”Ÿæˆ4åˆ—
                for( var i = 1;i<=4;i++ ){
                    //åˆ›å»ºliæ ‡ç­¾
                    var newLi = document.
                    createElement("li");
                    //æ·»åŠ ç±»å
                    newLi.className = "check";
                    //å½“éšæœºæ•°ç­‰äºéå†åˆ›å»ºçš„liæ ‡ç­¾ï¼Œç»‘å®šactiveç±»,ç”Ÿæˆé»‘å—
                    if( random == i ){
                        // æ·»åŠ ç±»åï¼Œç”Ÿæˆé»‘å—
                        newLi.classList.add("active");
                    }
                    //æŠŠåˆ—æ·»åŠ åˆ°è¡Œé‡Œé¢
                    newDiv.appendChild( newLi );
                }
                //æŠŠæ–°çš„ä¸€è¡Œæ·»åŠ åˆ°æœ€å‰é¢
                this.gameDom.insertBefore( newDiv , this.gameDom.firstChild );
                //å†æ¬¡æŠŠboxçš„topå€¼è®¾ç½®ä¸º-100
                this.gameDom.style.top = -100 +"px";
                // box.insertBefore( newDiv );

        }
        //æ¸¸æˆæœ€åä¸€è¡Œåˆ é™¤æ–¹æ³•
        Game.prototype.removeLine = function(){
            if( this.gameDom.children.length > 5 ){
                this.gameDom.lastElementChild.remove();
            }
        }
        //æ¸¸æˆè¢«ç‚¹å‡»çš„æ–¹æ³•
        Game.prototype.handleClick = function(){
            //ç¼“å­˜this
            // var that = this;
            this.gameDom.onclick = function( e ){
                e = e || window.event;
                if( this.isOver ){
                    alert("ç‚¹å‡»æŒ‰é’®ï¼Œåˆ·æ–°é¡µé¢é‡æ–°å¼€å§‹");
                }else{
                    //åˆ¤æ–­ç‚¹å‡»çš„ç›®æ ‡æ˜¯å¦å­˜åœ¨activeç±»
                    if( e.target.className == "check active" ){
                        //åˆ é™¤ç±»
                        e.target.classList.remove("active");
                        //ç‚¹å‡»é»‘å—åæ·»åŠ è‡ªå®šä¹‰å±æ€§
                        e.target.parentNode.setAttribute("data-pass",true);
                        //è®¡æ•°
                        this.num++
                        this.numInput.value = this.num;
                        //åˆ¤æ–­å½“valueå€¼%5ç­‰äº0æ—¶å¢åŠ ä¸‹è½é€Ÿåº¦
                        if( this.num % 5 == 0 ){
                            this.speed++
                        }

                    }else{
                        // ç‚¹å‡»ç™½å—æ—¶
                        alert("é”™å•¦!åœ¨æ—è¾¹å‘¢!!é‡æ–°æ¥å§ï¼Œæœ‹å‹ğŸ¥±")
                        //å…³é—­å®šæ—¶å™¨
                        window.clearInterval( this.timer );
                        //æ”¹å˜æ¸¸æˆçŠ¶æ€
                        this.isOver = true;
                    }
                }
            }.bind( this );
        }
        //åˆ¤æ–­æ¸¸æˆæœ€åä¸€è¡Œæ˜¯å¦å­˜åœ¨é»‘å—æ–¹æ³•
        Game.prototype.touchBottom = function(){
            //åˆ¤æ–­å½“è‡ªå®šä¹‰å±æ€§è§¦åº•æ—¶ï¼Œæ¸…é™¤å®šæ—¶å™¨
            if( this.gameDom.lastElementChild.getAttribute("data-pass") === null ){
                alert("è·Ÿä¸ä¸Šäº†ï¼Ÿä¸è¡Œäº†ï¼Ÿè¯¥åŠªåŠ›äº†ï¼Œæœ‹å‹ğŸ¤”");
                // æ¸…é™¤å®šæ—¶å™¨
                window.clearInterval( this.timer );
                //æ”¹å˜çŠ¶æ€
                this.isOver = true;
            }
        }
        //ç‚¹å‡»åˆ·æ–°é¡µé¢
        Game.prototype.refresh = function(){
            
            this.btn.onclick = function(){
                location.reload();
                console.log(111);
            }
        }
        //æ¸¸æˆåˆå§‹åŒ–æ–¹æ³•
        Game.prototype.init = function(){
            //è°ƒç”¨æ¸¸æˆåŒºæ‰è½æ–¹æ³•
            this.moveDown();
            //è°ƒç”¨ç‚¹å‡»äº‹ä»¶æ–¹æ³•
            this.handleClick();

            this.refresh();
        };

        new Game();
        
        </script>
</body>
</html>